# Plan 단계 독립 WIP

## 기본 정보
- **WorkID**: WIP-20260224-001
- **스테이지**: Plan
- **담당 에이전트**: analyst
- **생성일**: 2026-02-24
- **상태**: 완료

---

## 🔒 절대 규칙 준수 확인 (강제)

> **강제 체크**: 이 체크박스를 모두 체크해야만 작업 완료로 간주됩니다.

### analyst 절대 규칙 체크
- [x] 무조건 캐스팅 (Type)cast 남용하지 않음
- [x] 불필요한 dynamic 사용하지 않음
- [x] 빈 catch 블록이 없음
- [x] IsBusy 상태가 try-finally로 보장됨
- [x] 빈 catch 블록 없음
- [x] 테스트 삭제하지 않음
- [x] 커밋 없이 파일 수정하지 않음 (사용자 요청 전)
- [x] 단언 없이 추측하지 않음
- [x] 개발 파이프라인 지침을 파괴하지 않음
- [x] 모든 위반이 없음을 확인함

---

## 지시 정보

### 작업 대상 (Target)
- FEATURE_BACKLOG.md의 **1번 기능: 릴리즈 버전 체크 및 새 버전 다운로드 알림** 구현

### 변경 파일 (Files)
- `Models/VersionInfo.cs` (신규)
- `Services/UpdateCheckService.cs` (신규)
- `Models/AppSettings.cs` (수정)
- `Models/ProjectConstants.cs` (수정)
- `Views/DashboardView.xaml` (수정)
- `Views/SettingsWindow.xaml` (수정)
- `ViewModels/MainViewModel.cs` (수정)

### 필수 조건 (Requirements)
- GitHub 저장소: `weperld/ExcelBinder`
- 업데이트 확인 시점: 앱 시작 시 자동 백그라운드 체크 + Settings에서 수동 확인 버튼
- 프리릴리즈: 제외 (정식 릴리즈만)
- 인앱 다운로드 없음 (브라우저로 GitHub 릴리즈 페이지 연결)
- 네트워크 오류 시 graceful 처리 (앱 사용을 막지 않음)

---

## 작업 진행 내용

### 1단계: 확인 및 분석 (Confirm & Analyze)
- [x] 지시 내용 확인
- [x] 관련 파일 목록 파악
- [x] 기존 코드/문서 분석
- [x] 유형 판단 (신규)
- [x] 영향 범위 분석

### 2단계: 계획 (Plan)
- [x] 작업 계획 수립
- [x] 예상 변경 파일 정리
- [x] 위험 요소 식별
- [x] 사용자 확인 요청 준비

### 3단계: 실행 (Execute)
- [x] 계획 문서화
- [x] **수렴 분석**: 계획 결과물에 대한 보완 사항 도출
- [x] 보완 사항 분류 (필수/선택) 및 필수 보완 사항 반영
- [x] 수렴 확인: 필수 보완 사항 0건 달성
- [x] 잔존 선택 보완 사항 목록 기록
- [ ] 사용자 확인 요청
- [ ] 사용자 응답 기록
- [ ] Gate 준비

---

## 분석 결과

### 유형 판단
- **유형**: 신규 (New Feature)
- **근거**: 기존에 업데이트 관련 코드가 전혀 없음. 새로운 모델, 서비스, UI 요소 추가 필요.

### 영향 분석

#### 신규 파일
| 파일 | 역할 |
|------|------|
| `Models/VersionInfo.cs` | GitHub Releases API 응답 매핑 모델 |
| `Services/UpdateCheckService.cs` | 버전 체크 서비스 (HttpClient, SemVer 비교) |

#### 수정 파일
| 파일 | 변경 내용 |
|------|----------|
| `Models/AppSettings.cs` | `CheckForUpdatesOnStartup` (bool) 속성 추가 |
| `Models/ProjectConstants.cs` | `Update` 상수 클래스 추가 (GitHub URL, 타임아웃 등) |
| `Views/DashboardView.xaml` | 상단에 업데이트 알림 배너 + 다운로드 버튼 추가 |
| `ViewModels/MainViewModel.cs` | 시작 시 버전 체크 호출, 알림 상태 속성 추가 |

- **위험도**: 낮음

### 상세 계획

#### Phase 1: 모델 및 상수

**Models/VersionInfo.cs (신규)**
```csharp
public class VersionInfo
{
    public string TagName { get; set; }      // "v1.3.0"
    public string HtmlUrl { get; set; }      // 릴리즈 페이지 URL
    public string Body { get; set; }         // 릴리즈 노트
    public bool IsNewer { get; set; }        // 현재 버전보다 새로운지 여부
}
```

**Models/ProjectConstants.cs (수정)**
- `Update` 내부 클래스 추가
  - `GitHubOwner = "weperld"`
  - `GitHubRepo = "ExcelBinder"`
  - `ApiUrl` (GitHub Releases latest endpoint)
  - `TimeoutSeconds = 10`
  - UI 메시지 상수

**Models/AppSettings.cs (수정)**
- `CheckForUpdatesOnStartup` (bool, 기본값 true) 속성 추가
- JSON 직렬화 속성 포함

#### Phase 2: 버전 체크 서비스

**Services/UpdateCheckService.cs (신규)**
- `static readonly HttpClient` 사용 (소켓 고갈 방지, TECHNICAL_RULES.md 준수)
- `CheckForUpdateAsync()`: GitHub Releases API 호출
  - `/releases/latest` 엔드포인트 사용 (프리릴리즈 자동 제외)
  - `tag_name`에서 버전 추출, 현재 앱 버전과 SemVer 비교
  - `VersionInfo` 반환 (새 버전이면 `IsNewer = true`)
- 네트워크 오류/타임아웃 시 `null` 반환 (앱 사용 차단하지 않음)
- 현재 앱 버전: `Assembly.GetExecutingAssembly().GetName().Version`으로 가져옴

#### Phase 3: UI 알림 (DashboardView)

**Views/DashboardView.xaml (수정)**
- 제목("Excel Binder") 아래, Feature 리스트 위에 알림 배너 추가
- `Visibility`를 `UpdateAvailable` 속성에 바인딩 (새 버전 있을 때만 표시)
- 배너 내용: "새 버전 {version}이 출시되었습니다" + "다운로드" 버튼
- 버튼 클릭 시 `OpenUpdatePageCommand` 실행

**ViewModels/MainViewModel.cs (수정)**
- 속성 추가: `UpdateAvailable` (bool), `LatestVersionInfo` (VersionInfo?)
- 커맨드 추가: `OpenUpdatePageCommand`, `CheckForUpdateCommand`
- 생성자에서 `Settings.CheckForUpdatesOnStartup`이 true이면 `CheckForUpdateAsync()` 호출
- `OpenUpdatePageCommand`: `Process.Start()`로 `HtmlUrl`을 기본 브라우저에서 열기
- `CheckForUpdateCommand`: Settings 화면에서 수동 확인용

### 위험 요소
| 위험 | 대응 |
|------|------|
| 방화벽/프록시에서 API 호출 실패 | 타임아웃 10초 + 실패 시 무시 (null 반환) |
| GitHub API Rate Limit (60회/시간, 미인증) | 앱 시작 시 1회만 호출하므로 문제 없음 |
| .NET 10에서 HttpClient 가용성 | 기본 제공, 추가 패키지 불필요 |
| tag_name 형식 다양성 ("v1.0.0", "1.0.0") | `v` 접두사 제거 후 Version.TryParse로 안전 파싱 |

### 수렴 분석

#### 수렴 반복 #1
- **발견된 보완 사항**: 3건 (필수 2건 / 선택 1건)
- **필수 보완 사항**:
  1. Settings UI에 "시작 시 업데이트 확인" 토글이 필요 → SettingsWindow.xaml 수정 필요 (영향 파일 추가)
  2. Settings UI에 수동 "업데이트 확인" 버튼 필요 → SettingsWindow.xaml 수정 필요
- **선택 보완 사항**:
  1. 릴리즈 노트 미리보기 (현재는 배너+버튼만) → 향후 확장으로 분류 (현재 범위 외)
- **결과**: 필수 보완 사항 반영 완료 (영향 파일 목록에 SettingsWindow.xaml 추가)

#### 수렴 반복 #2
- **발견된 보완 사항**: 0건 (필수 0건 / 선택 0건)
- **결과**: 수렴 달성

---

## 진척도
- **진척도**: 100%

---

## 크로스체크 결과

### architect 크로스체크 (Gate-1)
- [ ] 1차 검증 통과
- [ ] 2차 검증 통과
- [ ] 크로스체크 통과
- 상태: 대기 중
