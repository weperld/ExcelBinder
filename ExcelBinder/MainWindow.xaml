<Window x:Class="ExcelBinder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ExcelBinder.ViewModels"
        mc:Ignorable="d"
        Title="Excel Binder" Height="750" Width="1000" MinHeight="600" MinWidth="800">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Grid>
        <Frame x:Name="MainFrame" NavigationUIVisibility="Hidden"/>

        <!-- Update Indicator Button (shown when toast is dismissed but update exists) -->
        <Button HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,18,22,0"
                Visibility="{Binding IsUpdateIndicatorVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                Command="{Binding ShowUpdateBannerCommand}"
                Width="36" Height="36" Cursor="Hand" ToolTip="새 버전이 출시되었습니다. 클릭하여 확인하세요.">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="IndicatorBorder" Background="White" CornerRadius="18"
                            BorderBrush="{StaticResource SecondaryBrush}" BorderThickness="2">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.2" Color="#000000"/>
                        </Border.Effect>
                        <Grid>
                            <TextBlock Text="🔔" FontSize="15"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <!-- Red dot indicator -->
                            <Ellipse Width="10" Height="10" Fill="{StaticResource DangerBrush}"
                                     HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-2,-2,0"/>
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="IndicatorBorder" Property="Background" Value="{StaticResource LightBackgroundBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>

        <!-- Update Toast Notification -->
        <Border HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,15,20,0"
                Visibility="{Binding IsUpdateBannerVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                Background="White" BorderBrush="{StaticResource SecondaryBrush}" BorderThickness="1"
                CornerRadius="8" Padding="18,14" Width="300">
            <Border.Effect>
                <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.25" Color="#000000"/>
            </Border.Effect>
            <StackPanel>
                <DockPanel Margin="0,0,0,8">
                    <Button Content="✕" DockPanel.Dock="Right" Command="{Binding DismissUpdateBannerCommand}"
                            Width="24" Height="24" FontSize="12" Padding="0"
                            Background="Transparent" BorderThickness="0" VerticalAlignment="Top" Cursor="Hand"/>
                    <TextBlock Text="{Binding UpdateMessage}" FontSize="13" FontWeight="SemiBold" TextWrapping="Wrap"/>
                </DockPanel>
                <TextBlock Text="다운로드 버튼을 클릭하여 GitHub에서 업데이트하세요."
                           FontSize="11" Foreground="{StaticResource MutedTextBrush}" Margin="0,0,0,10"/>
                <Button Content="다운로드" Style="{StaticResource SecondaryButton}"
                        Command="{Binding OpenUpdatePageCommand}" Height="30" HorizontalAlignment="Stretch"/>
            </StackPanel>
        </Border>

        <!-- Loading Overlay -->
        <Grid Background="#55000000" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="0,0,0,10"/>
                <TextBlock Text="Processing... Please wait." Foreground="White" FontWeight="Bold" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
